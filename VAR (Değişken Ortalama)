// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// author : Â© dg_factor [16.06.2023, Istanbul]

// UYARI
// GeliÅŸtirme amaÃ§lÄ±dÄ±r, doÄŸrudan alÄ±m-satÄ±m stratejisi yerine ikame edilemez.

// AÃ‡IKLAMALAR
// AÅŸaÄŸÄ±daki komut, VAR/VIDYA hareketli ortalama tÃ¼rÃ¼nÃ¼ bir fonksiyon ÅŸeklinde sunar.
// Tradingview'da yayÄ±nlanmÄ±ÅŸ VAR (deÄŸiÅŸken ortalama) versiyonlarÄ±nÄ±n hepsi grafiÄŸin ilk barÄ±nda sÄ±fÄ±r deÄŸeri ile baÅŸlar, ilerleyen barlarda fiyata yaklaÅŸÄ±r. 
// Bu durum backtestlerde anlamsÄ±z sonuÃ§lar doÄŸurabilir. 
// Sorunsuz versiyonu aÅŸaÄŸÄ±da ğŸ§

//@version=5
indicator("VAR (DeÄŸiÅŸken Ortalama)", overlay=true)

kaynak  = close
uzunluk = input.int(200)

// VAR - Variable Index Dynamic Adaptive Moving Average [Tushar S. Chande]
f_var(data, u) =>
    x = ta.sma(data, u)
    a = 9
    b = data > data[1] ? data - data[1] : 0
    c = data < data[1] ? data[1] - data : 0
    d = math.sum(b, a)
    e = math.sum(c, a)
    f = nz((d - e) / (d + e))
    g = math.abs(f)
    k = 2 / (u + 1)
    r = 0.0
    r := u == 1 ? data : na(r[1]) ? x : g * k * (data - nz(r[1])) + nz(r[1])
//

plot(f_var(kaynak, uzunluk), title="VAR")
